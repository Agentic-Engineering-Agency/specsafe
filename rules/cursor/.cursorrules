# SpecSafe Rules for Cursor v0.4.0
# OpenSpec-Style Workflow Configuration
# https://github.com/luci-efe/specsafe

## Always Check PROJECT_STATE.md
Before making changes, read PROJECT_STATE.md to understand:
- Current active specs and their stages
- Which spec is being worked on
- Requirements that must be satisfied

## Spec-Driven Development (SDD) Workflow

```
EXPLORE → NEW → SPEC → TEST → DEV → VERIFY → DONE
   │       │      │      │      │       │       │
   │       │      │      │      │       │       └── Archive spec
   │       │      │      │      │       └── Run tests, loop if fail
   │       │      │      │      └── Implement code
   │       │      │      └── Generate tests
   │       │      └── Detailed requirements
   │       └── Create PRD + tech stack
   └── Research & ideation
```

## Stage-Aware Development

| Stage | Description | Your Role |
|-------|-------------|-----------|
| EXPLORE | Research & validate ideas | Help evaluate approaches |
| NEW | PRD with requirements | Create PRD, tech stack, rules |
| SPEC | Detailed specification | Generate scenarios & acceptance criteria |
| TEST | Test generation | Create tests from Given/When/Then |
| DEV | Implementation | Write code to pass tests |
| VERIFY | Test validation | Run tests, fix failures, loop |
| DONE | Completion | Archive, summarize, celebrate |

## The 7 OpenSpec-Style Commands

### /specsafe:explore — Pre-Spec Exploration
**When to use:** Before committing to a spec, explore ideas and validate approaches.

**Your responsibilities:**
- Guide problem definition and user identification
- Research existing solutions and competitors
- Evaluate technology options with pros/cons
- Estimate effort (S/M/L/XL)
- Output: `specs/exploration/FEATURE-NAME.md` with findings

**Decision gate:** Recommend proceed to `/specsafe:new` or need more research.

---

### /specsafe:new — Initialize Spec with PRD
**When to use:** Starting a new feature with validated concept.

**Your responsibilities:**
1. Generate spec ID: `SPEC-YYYYMMDD-NNN`
2. Create PRD with:
   - Problem statement and target users
   - 3-5 key requirements
   - 2-3 user scenarios/stories
   - Constraints and assumptions
3. Recommend tech stack (language, framework, testing)
4. Define project-specific rules
5. Output: `specs/drafts/SPEC-ID.md` + update PROJECT_STATE.md

**Always confirm with user before writing files.**

---

### /specsafe:spec — Generate Detailed Spec
**When to use:** PRD exists, need implementation-ready specification.

**Your responsibilities:**
1. Read PRD from `specs/drafts/SPEC-ID.md`
2. Create comprehensive spec with:
   - **Overview:** Executive summary, goals, non-goals
   - **Requirements:** FR-001, FR-002... (functional)
   - **Technical Requirements:** TR-001, TR-002... (performance, security)
   - **Scenarios:** Given/When/Then format
   - **Acceptance Criteria:** Checklist for completion
   - **Architecture Notes:** Components, data flow, APIs
   - **Open Questions:** Document unresolved decisions
3. Move to `specs/active/SPEC-ID.md`
4. Update PROJECT_STATE.md: DRAFT → SPEC stage

**Validate:** Every requirement must be testable.

---

### /specsafe:test — Create Tests from Spec
**When to use:** Spec is ready, time to define verification.

**Your responsibilities:**
1. Read spec scenarios from `specs/active/SPEC-ID.md`
2. Determine test strategy:
   - Unit tests (functions/components)
   - Integration tests (APIs, services)
   - E2E tests (user workflows)
   - Performance tests (if benchmarks specified)
3. Generate test files: `src/__tests__/SPEC-ID/*.test.ts`
4. Map each scenario to test cases:
   ```typescript
   describe('Feature: [Name]', () => {
     describe('Scenario: [Name]', () => {
       it('should [expected outcome]', () => {
         // Given [setup]
         // When [action]
         // Then [assertion]
       });
     });
   });
   ```
5. Update PROJECT_STATE.md: SPEC → TEST stage
6. Output: Test count, coverage expectations

---

### /specsafe:dev — Development Mode
**When to use:** Tests exist, implement to make them pass.

**Your responsibilities:**
1. Read spec requirements and test expectations
2. Guide iterative development:
   - **Plan:** Smallest slice of functionality
   - **Implement:** One requirement at a time
   - **Test:** Run tests, fix failures
   - **Commit:** Small commits with spec reference
3. Enforce rules:
   - Every change maps to a requirement
   - Never modify tests to pass (fix code instead)
   - Keep functions small and focused
   - Document public APIs with JSDoc
4. Update PROJECT_STATE.md: TEST → CODE stage
5. After each checkpoint: verify against acceptance criteria

**Ask:** "Which requirement should we tackle next?"

---

### /specsafe:verify — Test & Iterate
**When to use:** Implementation complete, need validation.

**Your responsibilities:**
1. Read spec for expected behavior
2. Run test suite: `npm test -- SPEC-ID`
3. For each failure:
   - Identify failing assertion
   - Map to specific requirement
   - Determine: bug vs. test expectation issue
   - **Fix the code, not the test** (unless confirmed wrong)
4. Iterate: `Run → Analyze → Fix → Run` until all pass
5. Check coverage meets spec requirements
6. Run full suite for regressions
7. Update PROJECT_STATE.md: CODE → QA stage

**Output:** Pass rate, coverage %, remaining issues

---

### /specsafe:done — Complete & Archive
**When to use:** All tests pass, ready to finalize.

**Your responsibilities:**
1. Verify completion checklist:
   - [ ] All requirements implemented
   - [ ] All tests passing
   - [ ] Code reviewed (if required)
   - [ ] Documentation updated
   - [ ] No TODO/debug code
2. Run final test suite
3. Archive process:
   - Move: `specs/active/SPEC-ID.md` → `specs/archive/SPEC-ID.md`
   - Update PROJECT_STATE.md: move to COMPLETED
4. Generate summary: date, files, tests, LOC, notes
5. Suggest next spec from active list

**Ask for confirmation before archiving.**

---

## Critical Rules

### ✅ ALWAYS
- Read PROJECT_STATE.md before making changes
- Ensure implementation satisfies tests
- Use `specsafe` CLI commands to advance stages
- Reference spec ID in commit messages: `feat(SPEC-001): add user auth`
- Run tests before marking work complete

### ❌ NEVER
- Skip tests to implement faster
- Modify specs without updating PROJECT_STATE.md
- Commit code without corresponding spec entry
- Break the verify loop by ignoring test failures
- Modify tests to make them pass without discussion

## File Organization

```
my-project/
├── specs/
│   ├── drafts/          # PRD stage specs
│   ├── active/          # In-progress specs
│   ├── archive/         # Completed specs
│   └── exploration/     # Research notes
├── src/
│   └── __tests__/       # Test files organized by spec
├── PROJECT_STATE.md     # Central status tracker
└── specsafe.config.json # Tool configuration
```

## Commit Message Format

```
type(SPEC-ID): brief description

- Detailed change 1
- Detailed change 2

Refs: SPEC-ID
```

Types: `feat`, `fix`, `test`, `docs`, `refactor`, `chore`

---
*Version: 0.4.0*  
*OpenSpec-Style Workflow Enabled*
